# 竞赛集训系统前端文档

## 📋 文档说明

本文档旨在帮助开发者快速了解前端项目的当前状态和维护方向。当前阶段的主要目标是**样式优化**，暂不开发新功能。

---

## 🏗️ 项目结构

```
src/
├── api/                    # API 接口定义
│   ├── contest.ts         # 赛事相关接口
│   ├── problem.ts         # 题目相关接口
│   ├── submission.ts      # 提交相关接口
│   ├── training.ts        # 训练计划接口
│   └── user.ts            # 用户相关接口
│
├── assets/                 # 静态资源（图片、字体等）
│
├── components/             # 公共组件
│   ├── CodeEditor.vue     # 代码编辑器组件
│   ├── Countdown.vue      # 倒计时组件
│   └── TestCaseResults.vue # 测试用例结果展示
│
├── layout/                 # 布局组件
│   └── index.vue          # 主布局（导航栏、侧边栏）
│
├── router/                 # 路由配置
│   └── index.ts           # 路由定义与权限控制
│
├── store/                  # Pinia 状态管理
│   └── user.ts            # 用户状态（登录、角色等）
│
├── types/                  # TypeScript 类型定义
│   ├── axios.d.ts         # Axios 类型扩展
│   └── index.ts           # 业务实体类型
│
├── utils/                  # 工具函数
│   ├── helpers.ts         # 通用辅助函数（格式化、状态转换）
│   └── request.ts         # Axios 请求封装
│
├── views/                  # 页面视图
│   ├── admin/             # 管理员页面
│   ├── contest/           # 赛事相关页面
│   ├── dashboard/         # 仪表盘
│   ├── error/             # 错误页面（404等）
│   ├── judge/             # 评测相关
│   ├── login/             # 登录页面
│   ├── participant/       # 参赛者相关
│   ├── problem/           # 题目相关页面
│   ├── register/          # 注册页面
│   ├── submission/        # 提交记录页面
│   └── training/          # 训练计划页面
│
├── App.vue                # 根组件
├── main.ts                # 入口文件
└── style.css              # 全局样式
```

---

## 🎨 样式维护指南

### 当前样式架构

| 文件 | 用途 | 维护建议 |
|------|------|----------|
| `style.css` | 全局样式、主题色、Element Plus 覆盖 | **主要维护文件** |
| 组件 `<style scoped>` | 组件局部样式 | 保持 scoped，避免污染 |
| Element Plus 主题 | UI 组件库样式 | 通过 CSS 变量覆盖 |

### 样式优化方向

#### 1. 减少 `!important` 使用

当前 `style.css` 中存在较多 `!important`，这会增加后续维护难度。

**优化策略：**
- 提高选择器优先级而非使用 `!important`
- 利用 `:deep()` 穿透 scoped 组件
- 使用 CSS 变量统一管理主题色

```css
/* ❌ 避免 */
.el-button {
  background-color: #409eff !important;
}

/* ✅ 推荐 */
.el-button.custom-btn {
  background-color: var(--primary-color);
}
```

#### 2. CSS 变量统一管理

建议在 `style.css` 顶部定义主题变量：

```css
:root {
  /* 主题色 */
  --primary-color: #409eff;
  --success-color: #67c23a;
  --warning-color: #e6a23c;
  --danger-color: #f56c6c;
  --info-color: #909399;
  
  /* 背景色 */
  --bg-primary: #1a1a2e;
  --bg-secondary: #16213e;
  --bg-card: #0f3460;
  
  /* 文字色 */
  --text-primary: #e0e0e0;
  --text-secondary: #a0a0a0;
  
  /* 边框 */
  --border-color: rgba(255, 255, 255, 0.1);
  --border-radius: 8px;
}
```

#### 3. 组件样式隔离

每个组件的样式应该使用 `<style scoped>`，确保不会影响其他组件：

```vue
<style scoped>
.my-component {
  /* 组件内样式 */
}

/* 穿透 Element Plus 组件 */
:deep(.el-input__inner) {
  border-radius: var(--border-radius);
}
</style>
```

---

## 📄 页面功能状态

### ✅ 已完成页面

| 页面 | 路由 | 说明 |
|------|------|------|
| 登录 | `/login` | 用户登录 |
| 注册 | `/register` | 用户注册 |
| 仪表盘 | `/dashboard` | 首页概览 |
| 赛事列表 | `/contests` | 公开访问 |
| 赛事详情 | `/contest/:id` | 公开访问 |
| 题目列表 | `/problems` | 需登录 |
| 题目详情 | `/problem/:id` | 需登录 |
| 训练计划列表 | `/training` | 需登录 |
| 训练计划详情 | `/training/:id` | 基础信息展示 |
| 用户管理 | `/admin/users` | 管理员 |
| 题目管理 | `/admin/problems` | 教师/管理员 |

### 🚧 开发中页面（占位状态）

以下页面目前显示"功能开发中"，因为后端接口尚未实现：

| 页面 | 路由 | 依赖后端接口 |
|------|------|-------------|
| 赛事排名 | `/contest/:id/ranking` | 排名统计接口 |
| 代码提交 | `/problem/:id/submit` | 评测相关接口 |
| 题解管理 | `/problem/:id/solution` | 题解 CRUD 接口 |
| 提交记录 | `/submissions` | 提交列表接口 |
| 提交详情 | `/submission/:id` | 提交详情接口 |
| 比赛答题 | `/contest/:id/arena` | 比赛答题接口 |

---

## 🔧 技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Vue | 3.x | 前端框架 |
| TypeScript | 5.x | 类型系统 |
| Vite | 5.x | 构建工具 |
| Pinia | 2.x | 状态管理 |
| Vue Router | 4.x | 路由管理 |
| Element Plus | 2.x | UI 组件库 |
| Axios | 1.x | HTTP 请求 |

---

## 🔗 后端对接

### 接口代理配置

开发环境下，API 请求代理到后端服务：

```typescript
// vite.config.ts
server: {
  proxy: {
    '/api': {
      target: 'http://localhost:8000',
      changeOrigin: true
    }
  }
}
```

### 响应格式

后端统一返回格式：

```typescript
interface ApiResponse<T> {
  code: number;    // 状态码，200 为成功
  msg: string;     // 消息
  data: T;         // 数据
}
```

### 状态枚举对照

| 含义 | 后端值 | 前端显示 |
|------|--------|----------|
| 未开始 | `SCHEDULED` | 未开始 |
| 进行中 | `ONGOING` | 进行中 |
| 已结束 | `ENDED` | 已结束 |

---

## 🎯 维护优先级

### 高优先级（样式相关）

1. **统一主题变量** - 将散落的颜色值收归 CSS 变量
2. **减少 !important** - 通过提高选择器优先级替代
3. **响应式优化** - 确保移动端显示正常
4. **暗色主题一致性** - 统一暗色主题下的各元素样式

### 中优先级

1. **组件提取** - 将重复的 UI 模式抽取为公共组件
2. **代码清理** - 移除未使用的样式和代码
3. **性能优化** - 图片懒加载、组件按需加载

### 低优先级（暂不处理）

1. 新功能开发
2. 后端接口补齐
3. 单元测试覆盖

---

## 📝 开发约定

### 命名规范

- **文件名**：小写 + 短横线（如 `user-list.vue`）
- **组件名**：PascalCase（如 `UserList`）
- **CSS 类名**：BEM 风格（如 `.user-card__header`）

### 代码风格

- 使用 TypeScript 严格模式
- 组件使用 `<script setup>` 语法
- 使用 ESLint + Prettier 格式化

### Git 提交规范

```
feat: 新功能
fix: 修复 bug
style: 样式调整（不影响功能）
refactor: 代码重构
docs: 文档更新
chore: 构建/工具变更
```

---

## 📞 常见问题

### Q: 如何修改主题颜色？

A: 修改 `src/style.css` 中的 CSS 变量定义，然后确保各组件使用这些变量。

### Q: Element Plus 组件样式如何覆盖？

A: 使用 `:deep()` 选择器穿透 scoped 样式：

```css
:deep(.el-button) {
  border-radius: 8px;
}
```

### Q: 新页面显示"功能开发中"怎么处理？

A: 这些页面依赖未实现的后端接口，等后端接口就绪后再开发前端功能。

---

*最后更新：2025年1月*

## **对话与迭代日志（会话摘要）**

- **摘要生成日期**：2025-11-30
- **问题描述**：用户报告 `赛事列表` 中状态标签“已结束”显示为“已结束..”或带多余省略号，影响暗色主题下的可读性。
- **已尝试修复（前端修改记录）**：
  - 多次调整并覆盖 `src/style.css` 中 `#app .el-tag` 的样式（增减 `max-width`、`white-space`、`text-overflow`、`overflow`、`word-break` 等属性），尝试阻止文本溢出/省略。
  - 在 `src/views/contest/list.vue` 中确认状态由 `statusLabel(row.status)` 渲染，未发现硬编码 `已结束..` 文本。
  - 建议检查运行时的 DOM（浏览器 DevTools）以确认实际渲染的元素、计算样式与是否存在 `scoped` 或更高优先级的 CSS 覆盖。
- **涉及的主要文件**：
  - `src/style.css`（多次修改，覆盖 Element Plus 标签样式）
  - `src/views/contest/list.vue`（状态文本通过 `statusLabel` 渲染）

- **当前状态**：
  - 开发者已对 `el-tag` 样式做多轮覆盖，但用户反馈问题仍存在，可能由运行时样式覆盖、浏览器渲染或组件结构导致（例如：标签内部嵌套 span、伪元素或 Element Plus 自带样式通过更高优先级/内联样式覆盖）。

- **排查建议 / 下一步**：
  1. 本地启动 dev server（`pnpm run dev`），打开 `/contests` 页面并在浏览器中检查：
     - 选中“已结束”标签对应的 DOM 元素，查看“Computed”或“样式”面板，确认哪些 CSS 规则生效、是否有 inline style 或更高优先级的选择器覆盖。 
     - 检查标签内部是否含有额外字符或伪元素（`:before` / `:after`）导致额外字符显示。
  2. 如果是 scoped 样式或组件内覆盖导致，尝试使用 `:deep()` 或更高优先级选择器在组件局部修复，或修改模板以明确包裹文本的元素并加上样式类。
  3. 请提供页面截图（带 DevTools 的 Elements 面板），或允许我继续在仓库中添加调试样式（例如临时加醒目背景或边框），以便快速定位哪个规则在运行时生效。

- **是否继续迭代？**
  - 当前建议：继续迭代。请确认是否允许我（1）运行更多调试样式并提交临时更改，或（2）由你在本地运行并贴出 DevTools 的截图/计算样式信息。

## **当前项目状态（详细）**

- **总体进度**：前端主要完成了暗色主题重构的第一轮工作，包括建立 CSS 变量体系、调整全局色彩（背景、文本、边框、高亮）并覆盖大部分 Element Plus 组件样式以匹配 GitHub Soft (Darkanian) 风格。

- **已完成工作（概要）**：
  - 在 `src/style.css` 中创建并使用大量 CSS 变量来统一主题色与语义颜色（accent / success / warning / danger / info 等）。
  - 覆盖 Element Plus 的主要组件样式（按钮、标签、表格、弹窗、选择器等），提高暗色主题一致性。
  - 在 `src/views/contest/list.vue` 等页完成页面级样式适配与局部布局优化。

- **当前已知问题（未完成/需跟进）**：
  1. `赛事列表` 中状态标签“已结束”仍会在某些环境下显示多余的“..”（省略号或点），尽管已在 `src/style.css` 对 `#app .el-tag` 做多次覆盖但问题仍复现。可能原因包括：
     - Element Plus 或浏览器默认样式具有更高优先级或内联样式覆盖了本地覆盖规则。
     - 标签内部可能存在额外的嵌套元素或伪元素（`:before`/`:after`）在运行时添加了字符或样式。
     - 本地构建/热更新未成功（当前 `pnpm run dev` 在你的环境中有报错），导致本地页面实际加载的并不是最新样式。
  2. 目前在仓库中做的样式覆盖中使用了部分 `!important`，这是可行的临时手段，但长期会降低可维护性，需要逐步替换为更精确的选择器或组件级穿透（`:deep()`）策略。

- **阻塞与环境注意事项**：
  - 从你提供的终端信息看，`pnpm run dev` 在当前工作目录或主仓库运行时出现了错误（Exit Code: 1），这会阻碍在浏览器中实时调试样式。需要先确认 dev server 能正常启动，或在浏览器里打开线上/暂存页面进行排查。

- **推荐的短期行动项（优先级高）**：
  1. 修复或确认本地 dev server 能启动（运行 `pnpm run dev` 于 `frontend/contest_training_system` 目录），并在浏览器打开问题页面。若遇到构建错误，将错误日志贴出以便我协助定位。
  2. 在浏览器 DevTools 的 Elements -> Computed/Styles 面板中选中问题 `el-tag`，采集以下信息并粘贴给我：
     - 生效的 CSS 规则（带来源文件/行号）
     - 该元素的 HTML 结构（包括子节点与伪元素）
     - 若存在：任何内联样式或通过 JS 动态添加的 class
  3. 若不便运行或截图，我可以在仓库里添加受控的调试样式（例如为 `.el-tag` 添加红色边框 / 背景并提交），帮助在用户界面中快速识别哪个规则生效；此类改动将在问题定位后回退或注释。

- **长期建议（可并行）**：
  - 将对 Element Plus 的覆盖改为基于 CSS 变量与更精确选择器，尽量减少全局 `!important` 使用。
  - 将常用 UI 模式抽象为小的可复用组件（例如 `StatusTag`），在组件层面管理样式和行为，避免在多个位置重复覆盖样式。

---

_注：我已把上面的诊断和建议追加到本文件的“对话与迭代日志（会话摘要）”节。若你同意我继续调试（例如提交临时调试样式或协助修复 dev server），请回复“继续”，并说明是否允许我提交临时调试修改。_

