import{d as q,u as z,r as v,s as L,k as $,p as G,c as H,a as b,x as J,l as p,q as V,b as l,w as e,e as r,z as Z,L as j,E as U,i as s,t as i,o as c,M as K,_ as O}from"./index-jbbSaPHq.js";const Q={class:"participant-profile page-shell"},W={class:"page-header"},X={class:"header-actions"},Y=q({__name:"MyProfile",setup(ee){const A=z(),y=v(!1),w=v(!1),d=v(!1),t=v({}),h=v(),o=L({nickname:"",phoneNumber:"",password:""}),D=$(()=>({ADMIN:"管理员",TEACHER:"教师",JUDGE:"评委",STUDENT:"学生"})[t.value.role?.toUpperCase()||""]||"未知"),x={nickname:[{required:!0,message:"请输入昵称",trigger:"blur"},{min:2,max:20,message:"昵称长度应在2-20字符之间",trigger:"blur"}],phoneNumber:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号格式",trigger:"blur"}]},N=async()=>{y.value=!0;try{const n=await j();t.value=n.data||{}}catch(n){console.error(n),U.error("获取用户信息失败")}finally{y.value=!1}},M=()=>{d.value=!0,o.nickname=t.value.nickname||"",o.phoneNumber=t.value.phoneNumber||"",o.password=""},I=()=>{d.value=!1,o.nickname="",o.phoneNumber="",o.password=""},P=async()=>{h.value&&await h.value.validate(async n=>{if(n){w.value=!0;try{const a={nickname:o.nickname,phoneNumber:o.phoneNumber};o.password&&o.password.trim()&&(a.password=o.password),await K(a),U.success("资料更新成功"),await N(),await A.fetchUserProfile(),d.value=!1}catch(a){console.error(a)}finally{w.value=!1}}})},T=n=>n?n.replace("T"," ").replace(/\.\d{3}Z?$/,""):"";return G(N),(n,a)=>{const g=r("el-button"),u=r("el-descriptions-item"),C=r("el-tag"),B=r("el-descriptions"),m=r("el-input"),f=r("el-form-item"),k=r("el-col"),E=r("el-row"),R=r("el-form"),F=r("el-card"),S=Z("loading");return c(),H("div",Q,[b("div",W,[a[7]||(a[7]=b("div",null,[b("h2",{class:"page-header__title"},"我的资料"),b("p",{class:"page-header__subtitle"},"管理您的个人信息")],-1)),b("div",X,[d.value?V("",!0):(c(),p(g,{key:0,type:"primary",onClick:M},{default:e(()=>[...a[3]||(a[3]=[s("编辑资料",-1)])]),_:1})),d.value?(c(),p(g,{key:1,type:"success",loading:w.value,onClick:P},{default:e(()=>[...a[4]||(a[4]=[s("保存",-1)])]),_:1},8,["loading"])):V("",!0),d.value?(c(),p(g,{key:2,onClick:I},{default:e(()=>[...a[5]||(a[5]=[s("取消",-1)])]),_:1})):V("",!0),l(g,{type:"info",plain:"",onClick:N},{default:e(()=>[...a[6]||(a[6]=[s("刷新",-1)])]),_:1})])]),J((c(),p(F,{class:"page-card"},{default:e(()=>[d.value?(c(),p(R,{key:1,ref_key:"profileFormRef",ref:h,model:o,rules:x,"label-width":"100px"},{default:e(()=>[l(E,{gutter:24},{default:e(()=>[l(k,{span:12},{default:e(()=>[l(f,{label:"昵称",prop:"nickname"},{default:e(()=>[l(m,{modelValue:o.nickname,"onUpdate:modelValue":a[0]||(a[0]=_=>o.nickname=_),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1})]),_:1}),l(k,{span:12},{default:e(()=>[l(f,{label:"联系电话",prop:"phoneNumber"},{default:e(()=>[l(m,{modelValue:o.phoneNumber,"onUpdate:modelValue":a[1]||(a[1]=_=>o.phoneNumber=_),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(E,{gutter:24},{default:e(()=>[l(k,{span:12},{default:e(()=>[l(f,{label:"学号"},{default:e(()=>[l(m,{value:t.value.studentId,disabled:"",placeholder:"学号不可修改"},null,8,["value"])]),_:1})]),_:1}),l(k,{span:12},{default:e(()=>[l(f,{label:"邮箱"},{default:e(()=>[l(m,{value:t.value.email,disabled:"",placeholder:"邮箱不可修改"},null,8,["value"])]),_:1})]),_:1})]),_:1}),l(f,{label:"修改密码"},{default:e(()=>[l(m,{modelValue:o.password,"onUpdate:modelValue":a[2]||(a[2]=_=>o.password=_),type:"password",placeholder:"如需修改密码请输入新密码，否则留空","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):(c(),p(B,{key:0,column:2,border:"",size:"default"},{default:e(()=>[l(u,{label:"用户ID"},{default:e(()=>[s(i(t.value.userId||"-"),1)]),_:1}),l(u,{label:"学号"},{default:e(()=>[s(i(t.value.studentId||"-"),1)]),_:1}),l(u,{label:"昵称"},{default:e(()=>[s(i(t.value.nickname||"-"),1)]),_:1}),l(u,{label:"邮箱"},{default:e(()=>[s(i(t.value.email||"-"),1)]),_:1}),l(u,{label:"联系电话"},{default:e(()=>[s(i(t.value.phoneNumber||"-"),1)]),_:1}),l(u,{label:"角色"},{default:e(()=>[l(C,{type:"info"},{default:e(()=>[s(i(D.value),1)]),_:1})]),_:1}),l(u,{label:"账户状态"},{default:e(()=>[l(C,{type:t.value.isActive!==null&&t.value.isActive!==void 0?t.value.isActive?"success":"danger":"info"},{default:e(()=>[s(i(t.value.isActive!==null&&t.value.isActive!==void 0?t.value.isActive?"激活":"未激活":"未知"),1)]),_:1},8,["type"])]),_:1}),l(u,{label:"注册时间"},{default:e(()=>[s(i(T(t.value.createdAt)||"-"),1)]),_:1})]),_:1}))]),_:1})),[[S,y.value]])])}}}),ae=O(Y,[["__scopeId","data-v-5f9bc3c9"]]);export{ae as default};
