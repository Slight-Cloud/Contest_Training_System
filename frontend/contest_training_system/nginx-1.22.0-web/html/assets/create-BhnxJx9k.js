import{d as T,u as j,r as f,k as V,g as W,s as $,p as F,c as I,a as s,b as t,t as _,w as l,e as i,E as n,i as w,q as G,C as U,N as J,O as K,f as Q,o as Z,_ as X}from"./index-jbbSaPHq.js";import{a as Y,u as ee,c as te}from"./problem-FBqKQ2cr.js";const le={class:"problem-create-page page-shell"},ae={class:"page-header"},oe={class:"page-header__title"},re={class:"page-header__subtitle"},se={class:"header-actions"},ue={class:"upload-section"},ie={key:0,class:"current-file"},ne="/file/upload/testdata",pe=T({__name:"create",setup(de){const x=W(),v=Q(),P=j(),g=f(),q=f(),b=f(!1),p=V(()=>x.name==="ProblemEdit"),h=V(()=>{const o=x.params.id;return Array.isArray(o)?Number(o[0]):Number(o)}),a=$({title:"",description:"",inputSpec:"",outputSpec:"",sampleInput:"",sampleOutput:"",remark:"",timeLimit:1e3,memoryLimit:256,testdataZip:""}),B=f([]),O={title:[{required:!0,message:"请输入题目标题",trigger:"blur"},{min:2,max:100,message:"标题长度应在2-100字符之间",trigger:"blur"}],description:[{required:!0,message:"请输入题目描述",trigger:"blur"},{min:10,max:5e3,message:"描述长度应在10-5000字符之间",trigger:"blur"}],inputSpec:[{required:!0,message:"请输入输入说明",trigger:"blur"}],outputSpec:[{required:!0,message:"请输入输出说明",trigger:"blur"}],sampleInput:[{required:!0,message:"请输入输入样例",trigger:"blur"}],sampleOutput:[{required:!0,message:"请输入输出样例",trigger:"blur"}],timeLimit:[{required:!0,message:"请设置时间限制",trigger:"blur"},{type:"number",min:100,max:1e4,message:"时间限制应在100-10000ms之间",trigger:"blur"}],memoryLimit:[{required:!0,message:"请设置内存限制",trigger:"blur"},{type:"number",min:16,max:1024,message:"内存限制应在16-1024MB之间",trigger:"blur"}],testdataZip:[{required:!p.value,message:"请上传测试数据包",trigger:"change"}]},M=V(()=>({Authorization:`Bearer ${P.token}`})),C=async()=>{if(p.value)try{const o=await Y(h.value);if(o&&o.data){const e=o.data;Object.assign(a,{title:e.title,description:e.description,inputSpec:e.inputSpec,outputSpec:e.outputSpec,sampleInput:e.sampleInput,sampleOutput:e.sampleOutput,remark:e.remark||"",timeLimit:e.timeLimit,memoryLimit:e.memoryLimit,testdataZip:""})}}catch(o){console.error(o),n.error("获取题目信息失败")}},N=o=>{const e=o.type==="application/zip"||o.name.endsWith(".zip"),c=o.size/1024/1024<50;return e?c?!0:(n.error("文件大小不能超过50MB!"),!1):(n.error("只能上传ZIP格式文件!"),!1)},R=o=>{o.code===1?(a.testdataZip=o.data.file_url,n.success("测试数据上传成功")):n.error(o.msg||"上传失败")},E=()=>{n.error("上传失败，请重试")},z=async()=>{g.value&&await g.value.validate(async o=>{if(o){b.value=!0;try{const e={...a};p.value?(e.problemId=h.value,await ee(e),n.success("题目修改成功")):(await te(e),n.success("题目创建成功")),v.push({name:"ProblemList"})}catch(e){console.error(e)}finally{b.value=!1}}})},A=()=>{v.back()};return F(()=>{p.value&&C()}),(o,e)=>{const c=i("el-button"),d=i("el-input"),u=i("el-form-item"),m=i("el-col"),S=i("el-input-number"),y=i("el-row"),L=i("el-card"),k=i("el-icon"),D=i("el-upload"),H=i("el-form");return Z(),I("div",le,[s("div",ae,[s("div",null,[s("h2",oe,_(p.value?"编辑题目":"新建题目"),1),s("p",re,_(p.value?"修改题目信息和测试数据":"创建新的题目，设置题目描述和测试数据"),1)]),s("div",se,[t(c,{text:"",type:"primary",onClick:A},{default:l(()=>[...e[9]||(e[9]=[w("返回",-1)])]),_:1}),t(c,{type:"success",loading:b.value,onClick:z},{default:l(()=>[w(_(p.value?"保存修改":"创建题目"),1)]),_:1},8,["loading"])])]),t(H,{ref_key:"formRef",ref:g,model:a,rules:O,"label-width":"120px",class:"problem-form"},{default:l(()=>[t(L,{class:"page-card"},{header:l(()=>[...e[10]||(e[10]=[s("span",null,"基本信息",-1)])]),default:l(()=>[t(y,{gutter:24},{default:l(()=>[t(m,{span:12},{default:l(()=>[t(u,{label:"题目标题",prop:"title"},{default:l(()=>[t(d,{modelValue:a.title,"onUpdate:modelValue":e[0]||(e[0]=r=>a.title=r),placeholder:"请输入题目标题",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1}),t(m,{span:6},{default:l(()=>[t(u,{label:"时间限制",prop:"timeLimit"},{default:l(()=>[t(S,{modelValue:a.timeLimit,"onUpdate:modelValue":e[1]||(e[1]=r=>a.timeLimit=r),min:100,max:1e4,step:100},null,8,["modelValue"]),e[11]||(e[11]=s("span",{class:"unit-text"},"ms",-1))]),_:1})]),_:1}),t(m,{span:6},{default:l(()=>[t(u,{label:"内存限制",prop:"memoryLimit"},{default:l(()=>[t(S,{modelValue:a.memoryLimit,"onUpdate:modelValue":e[2]||(e[2]=r=>a.memoryLimit=r),min:16,max:1024,step:16},null,8,["modelValue"]),e[12]||(e[12]=s("span",{class:"unit-text"},"MB",-1))]),_:1})]),_:1})]),_:1}),t(u,{label:"题目描述",prop:"description"},{default:l(()=>[t(d,{modelValue:a.description,"onUpdate:modelValue":e[3]||(e[3]=r=>a.description=r),type:"textarea",rows:6,placeholder:"请输入题目描述，支持HTML格式",maxlength:"5000","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(y,{gutter:24},{default:l(()=>[t(m,{span:12},{default:l(()=>[t(u,{label:"输入说明",prop:"inputSpec"},{default:l(()=>[t(d,{modelValue:a.inputSpec,"onUpdate:modelValue":e[4]||(e[4]=r=>a.inputSpec=r),type:"textarea",rows:4,placeholder:"请描述输入格式",maxlength:"2000","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1}),t(m,{span:12},{default:l(()=>[t(u,{label:"输出说明",prop:"outputSpec"},{default:l(()=>[t(d,{modelValue:a.outputSpec,"onUpdate:modelValue":e[5]||(e[5]=r=>a.outputSpec=r),type:"textarea",rows:4,placeholder:"请描述输出格式",maxlength:"2000","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(y,{gutter:24},{default:l(()=>[t(m,{span:12},{default:l(()=>[t(u,{label:"输入样例",prop:"sampleInput"},{default:l(()=>[t(d,{modelValue:a.sampleInput,"onUpdate:modelValue":e[6]||(e[6]=r=>a.sampleInput=r),type:"textarea",rows:4,placeholder:"请输入样例输入",maxlength:"1000","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1}),t(m,{span:12},{default:l(()=>[t(u,{label:"输出样例",prop:"sampleOutput"},{default:l(()=>[t(d,{modelValue:a.sampleOutput,"onUpdate:modelValue":e[7]||(e[7]=r=>a.sampleOutput=r),type:"textarea",rows:4,placeholder:"请输入样例输出",maxlength:"1000","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(u,{label:"备注"},{default:l(()=>[t(d,{modelValue:a.remark,"onUpdate:modelValue":e[8]||(e[8]=r=>a.remark=r),type:"textarea",rows:3,placeholder:"题目备注信息（可选）",maxlength:"1000","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1}),t(L,{class:"page-card"},{header:l(()=>[...e[13]||(e[13]=[s("span",null,"测试数据",-1)])]),default:l(()=>[t(u,{label:"测试数据包",prop:"testdataZip"},{default:l(()=>[s("div",ue,[t(D,{ref_key:"uploadRef",ref:q,action:ne,headers:M.value,"before-upload":N,"on-success":R,"on-error":E,"file-list":B.value,limit:1,accept:".zip",drag:""},{tip:l(()=>[...e[14]||(e[14]=[s("div",{class:"el-upload__tip"}," 只能上传ZIP格式文件，且不超过50MB。ZIP包应包含输入文件(.in)和输出文件(.out) ",-1)])]),default:l(()=>[t(k,{class:"el-icon--upload"},{default:l(()=>[t(U(J))]),_:1}),e[15]||(e[15]=s("div",{class:"el-upload__text"},[w(" 将ZIP文件拖拽到此处，或"),s("em",null,"点击上传")],-1))]),_:1},8,["headers","file-list"]),a.testdataZip?(Z(),I("div",ie,[t(k,null,{default:l(()=>[t(U(K))]),_:1}),s("span",null,"当前文件："+_(a.testdataZip),1)])):G("",!0)])]),_:1})]),_:1})]),_:1},8,["model"])])}}}),fe=X(pe,[["__scopeId","data-v-27d5924f"]]);export{fe as default};
