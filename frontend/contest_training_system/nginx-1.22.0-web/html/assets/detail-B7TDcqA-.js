import{d as Z,r as T,k as w,p as K,A as he,c as L,t as d,o as u,_ as Q,u as Ce,g as ke,B as we,b as o,w as t,e as m,E as D,l as p,a as l,q as b,C as y,i as f,D as Te,G as q,H as Ee,I as Se,h as F,J as De,f as Ie}from"./index-jbbSaPHq.js";import{a as Ne,h as Ve,j as xe}from"./contest-Cg3IoMP6.js";import{g as Le,a as Ue,b as $e,f as W}from"./helpers-Cx3aqvDL.js";const Me={class:"countdown"},Oe=Z({__name:"Countdown",props:{endTime:{}},emits:["finish"],setup(A,{emit:U}){const E=A,I=U,r=T(0),g=T(null),a=w(()=>{if(r.value<=0)return"00:00:00";const v=Math.floor(r.value/86400),S=Math.floor(r.value%86400/3600),h=Math.floor(r.value%3600/60),N=r.value%60;return v>0?`${v}天 ${_(S)}:${_(h)}:${_(N)}`:`${_(S)}:${_(h)}:${_(N)}`}),_=v=>v.toString().padStart(2,"0"),c=()=>{const v=new Date(E.endTime.replace(" ","T")).getTime(),S=Date.now(),h=Math.floor((v-S)/1e3);h<=0?(r.value=0,g.value&&(clearInterval(g.value),g.value=null),I("finish")):r.value=h};return K(()=>{c(),g.value=setInterval(c,1e3)}),he(()=>{g.value&&clearInterval(g.value)}),(v,S)=>(u(),L("span",Me,d(a.value),1))}}),Ae=Q(Oe,[["__scopeId","data-v-bcd8e51c"]]),He={class:"contest-detail-page page-shell"},Pe={key:0},Re={class:"contest-header"},Ge={class:"contest-header__info"},Je={class:"contest-title"},Be={class:"contest-meta"},ze={class:"meta-item"},je={class:"contest-header__actions"},qe={class:"time-info"},Fe={class:"time-item"},We={class:"time-value"},Ze={class:"time-item"},Ke={class:"time-value"},Qe={class:"time-item"},Xe={class:"time-label"},Ye={class:"time-value countdown"},et={key:1,class:"ENDED-text"},tt=["innerHTML"],lt={class:"card-header"},at={class:"problem-index"},st={class:"problem-title-cell"},ot={class:"problem-title"},nt={class:"limit-cell"},it={class:"pass-rate"},ut={class:"notice-content"},rt=Z({__name:"detail",setup(A){const U=ke(),E=Ie(),I=Ce(),r=Number(U.params.id),g=T(!0),a=T(null),_=T([]),c=T(!1),v=T(!1),S=w(()=>I.role==="TEACHER"||I.role==="ADMIN"),h=w(()=>I.role==="STUDENT"),N=w(()=>S.value),X=["SCHEDULED"],Y=s=>!!s&&X.includes(s),ee=w(()=>h.value&&Y(a.value?.status)),H=w(()=>a.value?.status==="ONGOING"),te=["SCHEDULED","ONGOING"],le=s=>!!s&&te.includes(s),P=w(()=>a.value?a.value.status==="SCHEDULED"?a.value.startTime:a.value.endTime:""),ae=w(()=>le(a.value?.status)&&!!P.value),i=T({visible:!1,form:{password:"",teamName:""},submitting:!1}),$=async()=>{g.value=!0;try{const s=await Ne(r);a.value=s.data||null,_.value=a.value?.problems||[],a.value&&h.value&&await R()}catch(s){D.error(s?.message||"获取赛事详情失败")}finally{g.value=!1}},R=async()=>{if(a.value){if(!h.value){c.value=!1;return}if(!v.value){v.value=!0;try{const e=await Ve({contestId:r});if(typeof e=="boolean")c.value=e;else if(e&&typeof e=="object"){const C=e.data;typeof C=="boolean"?c.value=C:C!==void 0?c.value=!!C:c.value=!1}else c.value=!1}catch(s){console.warn("检查参赛状态失败：",s),c.value=!1}finally{v.value=!1}}}},se=()=>{i.value.visible=!0,i.value.form={password:"",teamName:""}},oe=async()=>{if(a.value?.visibility==="PRIVATE"&&!i.value.form.password){D.warning("请输入赛事密码");return}i.value.submitting=!0;try{await xe({contestId:r,password:i.value.form.password||void 0,teamName:i.value.form.teamName||void 0}),D.success("参赛成功"),i.value.visible=!1,c.value=!0,await $()}catch(s){D.error(s?.message||"参赛失败")}finally{i.value.submitting=!1}},ne=()=>{E.push({name:"ContestArena",params:{id:r}})},G=s=>{E.push({name:"ProblemDetail",params:{id:s},query:{contestId:r}})},ie=(s,e)=>{E.push({name:"ProblemSubmit",params:{id:s},query:{contestId:r,problemTitle:e,contestTitle:a.value?.title}})},ue=()=>{E.push({name:"ContestRanking",params:{id:r}})},re=()=>{E.push({name:"ContestList",query:{edit:r}})},de=s=>{G(s.problemId)},J=s=>"",ce=s=>"info",me=s=>"-",ve=()=>{const s=a.value?.status;s==="SCHEDULED"?D.success("赛事已开始，可以开始答题了！"):s==="ONGOING"&&D.info("赛事已结束，无法再提交答案。"),$()};return K(()=>{$()}),we(()=>h.value,s=>{s?R():c.value=!1}),(s,e)=>{const x=m("el-skeleton-item"),C=m("el-tag"),B=m("el-icon"),k=m("el-button"),M=m("el-card"),V=m("el-table-column"),pe=m("el-table"),z=m("el-empty"),fe=m("el-alert"),_e=m("el-skeleton"),O=m("el-form-item"),j=m("el-input"),be=m("el-form"),ye=m("el-dialog");return u(),L("div",He,[o(_e,{loading:g.value,animated:""},{template:t(()=>[o(x,{variant:"h1",style:{width:"40%","margin-bottom":"16px"}}),o(x,{variant:"text",style:{width:"80%","margin-bottom":"32px"}}),o(x,{variant:"rect",style:{height:"200px"}})]),default:t(()=>[a.value?(u(),L("div",Pe,[l("div",Re,[l("div",Ge,[l("h1",Je,d(a.value.title),1),l("div",Be,[o(C,{type:y(Le)(a.value.status),size:"large"},{default:t(()=>[f(d(y(Ue)(a.value.status,"contest")),1)]),_:1},8,["type"]),o(C,{type:"info",size:"large",effect:"plain"},{default:t(()=>[f(d(y($e)(a.value.visibility)),1)]),_:1}),l("span",ze,[o(B,null,{default:t(()=>[o(y(Te))]),_:1}),f(" "+d(a.value.participantCount||0)+" 人参赛 ",1)])])]),l("div",je,[N.value?(u(),p(k,{key:0,type:"warning",icon:y(q),onClick:re},{default:t(()=>[...e[4]||(e[4]=[f(" 编辑赛事 ",-1)])]),_:1},8,["icon"])):b("",!0),ee.value&&!c.value?(u(),p(k,{key:1,type:"primary",icon:y(Ee),loading:v.value,disabled:v.value,onClick:se},{default:t(()=>[...e[5]||(e[5]=[f(" 参加赛事 ",-1)])]),_:1},8,["icon","loading","disabled"])):b("",!0),c.value&&H.value?(u(),p(k,{key:2,type:"success",icon:y(q),onClick:ne},{default:t(()=>[...e[6]||(e[6]=[f(" 进入赛事 ",-1)])]),_:1},8,["icon"])):b("",!0),a.value.status==="ENDED"?(u(),p(k,{key:3,type:"info",icon:y(Se),onClick:ue},{default:t(()=>[...e[7]||(e[7]=[f(" 查看排名 ",-1)])]),_:1},8,["icon"])):b("",!0)])]),o(M,{class:"page-card time-card"},{default:t(()=>[l("div",qe,[l("div",Fe,[e[8]||(e[8]=l("div",{class:"time-label"},"开始时间",-1)),l("div",We,d(y(W)(a.value.startTime)),1)]),e[10]||(e[10]=l("div",{class:"time-divider"},null,-1)),l("div",Ze,[e[9]||(e[9]=l("div",{class:"time-label"},"结束时间",-1)),l("div",Ke,d(y(W)(a.value.endTime)),1)]),e[11]||(e[11]=l("div",{class:"time-divider"},null,-1)),l("div",Qe,[l("div",Xe,d(a.value.status==="SCHEDULED"?"距离开始":a.value.status==="ONGOING"?"剩余时间":"已结束"),1),l("div",Ye,[ae.value?(u(),p(Ae,{key:0,"end-time":P.value,onFinish:ve},null,8,["end-time"])):(u(),L("span",et,"赛事已结束"))])])])]),_:1}),a.value.description?(u(),p(M,{key:0,class:"page-card"},{header:t(()=>[...e[12]||(e[12]=[l("span",null,"赛事介绍",-1)])]),default:t(()=>[l("div",{class:"contest-description",innerHTML:a.value.description},null,8,tt)]),_:1})):b("",!0),o(M,{class:"page-card"},{header:t(()=>[l("div",lt,[l("span",null,"题目列表（"+d(_.value.length)+" 道）",1),N.value?(u(),p(C,{key:0,type:"warning",size:"small"},{default:t(()=>[...e[13]||(e[13]=[f("教师可见",-1)])]),_:1})):b("",!0)])]),default:t(()=>[o(pe,{data:_.value,class:"detail-table problem-table",onRowClick:de},{default:t(()=>[o(V,{label:"题号",width:"80",align:"center"},{default:t(({$index:n})=>[l("span",at,d(String.fromCharCode(65+n)),1)]),_:1}),o(V,{prop:"title",label:"题目名称","min-width":"250"},{default:t(({row:n})=>[l("div",st,[l("span",ot,d(n.title),1),J(n.problemId)?(u(),p(C,{key:0,type:ce(n.problemId),size:"small"},{default:t(()=>[f(d(J(n.problemId)),1)]),_:2},1032,["type"])):b("",!0)])]),_:1}),o(V,{label:"限制",width:"180",align:"center"},{default:t(({row:n})=>[l("div",nt,[l("span",null,d(n.timeLimit)+"ms",1),e[14]||(e[14]=l("span",{class:"divider"},"/",-1)),l("span",null,d(n.memoryLimit)+"MB",1)])]),_:1}),o(V,{label:"通过率",width:"120",align:"center"},{default:t(({row:n})=>[l("span",it,d(me(n.problemId)),1)]),_:1}),o(V,{label:"操作",width:"150",align:"center",fixed:"right"},{default:t(({row:n})=>[o(k,{type:"primary",text:"",size:"small",onClick:F(ge=>G(n.problemId),["stop"])},{default:t(()=>[...e[15]||(e[15]=[f(" 查看题目 ",-1)])]),_:1},8,["onClick"]),c.value&&H.value?(u(),p(k,{key:0,type:"success",text:"",size:"small",onClick:F(ge=>ie(n.problemId,n.title),["stop"])},{default:t(()=>[...e[16]||(e[16]=[f(" 提交 ",-1)])]),_:1},8,["onClick"])):b("",!0)]),_:1})]),_:1},8,["data"]),_.value.length?b("",!0):(u(),p(z,{key:0,description:"暂无题目"}))]),_:1}),a.value.status==="SCHEDULED"?(u(),p(fe,{key:1,type:"info",closable:!1,class:"notice-alert"},{title:t(()=>[l("div",ut,[o(B,null,{default:t(()=>[o(y(De))]),_:1}),e[17]||(e[17]=l("span",null,"赛事尚未开始，请在开始时间后参与答题",-1))])]),_:1})):b("",!0)])):(u(),p(z,{key:1,description:"赛事不存在或已被删除"}))]),_:1},8,["loading"]),o(ye,{modelValue:i.value.visible,"onUpdate:modelValue":e[3]||(e[3]=n=>i.value.visible=n),title:"参加赛事",width:"420px","close-on-click-modal":!1},{footer:t(()=>[o(k,{onClick:e[2]||(e[2]=n=>i.value.visible=!1)},{default:t(()=>[...e[18]||(e[18]=[f("取消",-1)])]),_:1}),o(k,{type:"primary",loading:i.value.submitting,onClick:oe},{default:t(()=>[...e[19]||(e[19]=[f(" 确认参赛 ",-1)])]),_:1},8,["loading"])]),default:t(()=>[o(be,{model:i.value.form,"label-width":"88px"},{default:t(()=>[o(O,{label:"赛事名称"},{default:t(()=>[l("span",null,d(a.value?.title),1)]),_:1}),a.value?.visibility==="PRIVATE"?(u(),p(O,{key:0,label:"赛事密码"},{default:t(()=>[o(j,{modelValue:i.value.form.password,"onUpdate:modelValue":e[0]||(e[0]=n=>i.value.form.password=n),type:"password",placeholder:"请输入赛事密码","show-password":""},null,8,["modelValue"])]),_:1})):b("",!0),o(O,{label:"队伍名称"},{default:t(()=>[o(j,{modelValue:i.value.form.teamName,"onUpdate:modelValue":e[1]||(e[1]=n=>i.value.form.teamName=n),placeholder:"可选，用于团队赛"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),vt=Q(rt,[["__scopeId","data-v-40aced0b"]]);export{vt as default};
