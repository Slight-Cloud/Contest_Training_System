import{d as ts,u as os,g as ls,r as f,k as A,B as ns,p as as,c as u,b as o,w as t,e as d,E as is,l as p,a as s,q as m,i as r,C as _,t as i,P as cs,Q as ds,G as us,R as rs,F as R,m as V,f as _s,o as n,_ as ms}from"./index-jbbSaPHq.js";import{a as ps}from"./problem-FBqKQ2cr.js";import{g as vs}from"./submission-B-N4RVi_.js";import{g as bs,a as hs,c as fs,f as gs}from"./helpers-Cx3aqvDL.js";const ys={class:"problem-detail-page page-shell"},ks={key:0},Ss={class:"problem-header"},Ts={class:"problem-header__info"},Ls={class:"problem-title"},ws={key:0,class:"problem-index"},Cs={class:"problem-meta"},Is={class:"meta-item"},Ms={class:"meta-item"},Hs={class:"problem-header__actions"},As={class:"section"},xs=["innerHTML"],Es={class:"section"},Ps=["innerHTML"],Us={class:"section"},zs=["innerHTML"],Bs={class:"section"},Ds={class:"code-block"},qs={class:"section"},Ns={class:"code-block"},Rs={key:0,class:"section"},Vs=["innerHTML"],$s={class:"submissions-section"},js={key:0,class:"submissions-list"},Fs=["onClick"],Gs={class:"submission-result"},Os={class:"submission-info"},Qs={class:"submission-user"},Js={class:"submission-time"},Ks={class:"submission-stats"},Ws={class:"solutions-section"},Xs={class:"solutions-header"},Ys={key:0,class:"solutions-list"},Zs={class:"solution-title"},se=["innerHTML"],ee={class:"solution-meta"},te={class:"statistics-section"},oe={class:"stat-card"},le={class:"stat-value"},ne={class:"stat-card"},ae={class:"stat-value"},ie={class:"stat-card"},ce={class:"stat-value"},de={class:"stat-card"},ue={class:"stat-value"},re={key:0,class:"datasets-section"},_e={key:0,class:"quick-actions"},me=ts({__name:"detail",setup(pe){const T=ls(),h=_s(),v=os(),b=Number(T.params.id),L=T.query.contestId?Number(T.query.contestId):null,B=T.query.index,x=f(!0),E=f("description"),c=f(null),g=f([]),w=f([]),C=f({totalSubmissions:0,acceptedSubmissions:0,passRate:0,uniqueUsers:0}),P=A(()=>v.role==="TEACHER"||v.role==="ADMIN"),$=A(()=>v.role==="STUDENT"),U=A(()=>P.value),D=A(()=>$.value||P.value),j=async()=>{console.log("=== 获取题目详情调试 ==="),console.log("题目ID:",b),console.log("当前用户角色:",v.role),console.log("当前用户token:",v.token?`${v.token.substring(0,20)}...`:"null"),x.value=!0;try{console.log("开始请求题目详情...");const a=await ps(b);console.log("题目详情响应:",a),c.value=a.data||null,console.log("题目详情数据:",c.value)}catch(a){console.error("获取题目详情失败:",a),console.error("错误详情:",a.response),is.error(a?.message||"获取题目详情失败")}finally{x.value=!1}},F=async()=>{try{console.log("开始获取题解数据...");const a=await fetch(`/api/problem/${b}/solution/list`,{method:"GET",headers:{Authorization:`Bearer ${v.token}`,"Content-Type":"application/json"}});if(a.ok){const y=(await a.json()).data||[];g.value=P.value?y:y.filter(k=>k.isPublished===1),console.log("题解数据加载成功:",g.value.length,"条")}else console.log("题解API返回错误状态:",a.status)}catch(a){console.log("题解数据加载失败，这是正常的（API可能未实现）:",a.message)}},G=async()=>{try{const e=(await vs({problemId:b,page:1,pageSize:10})).data||{};w.value=e.submissions||e.list||[]}catch{}},O=a=>{h.push({name:"SubmissionDetail",params:{id:a}})},q=()=>{h.push({name:"ProblemSubmit",params:{id:b},query:{contestId:L||void 0,problemTitle:c.value?.title}})},Q=()=>{h.push({name:"ProblemEdit",params:{id:b}})},J=()=>{h.push({name:"ProblemSolution",params:{id:b}})},K=()=>{L?h.push({name:"ContestDetail",params:{id:L}}):h.push({name:"ProblemList"})};return ns(E,a=>{a==="solutions"&&g.value.length===0&&(console.log("切换到题解标签，开始加载题解数据"),F()),a==="submissions"&&w.value.length===0&&G()}),as(async()=>{await j()}),(a,e)=>{const y=d("el-skeleton-item"),k=d("el-tag"),N=d("el-icon"),S=d("el-button"),I=d("el-tab-pane"),z=d("el-empty"),M=d("el-col"),W=d("el-row"),H=d("el-table-column"),X=d("el-link"),Y=d("el-table"),Z=d("el-tabs"),ss=d("el-card"),es=d("el-skeleton");return n(),u("div",ys,[o(es,{loading:x.value,animated:""},{template:t(()=>[o(y,{variant:"h1",style:{width:"60%","margin-bottom":"24px"}}),o(y,{variant:"rect",style:{height:"400px"}})]),default:t(()=>[c.value?(n(),u("div",ks,[s("div",Ss,[s("div",Ts,[s("h1",Ls,[_(B)?(n(),u("span",ws,i(_(B))+". ",1)):m("",!0),r(" "+i(c.value.title),1)]),s("div",Cs,[c.value.isHidden?(n(),p(k,{key:0,type:"warning",size:"small"},{default:t(()=>[...e[1]||(e[1]=[r("已隐藏",-1)])]),_:1})):m("",!0),s("span",Is,[o(N,null,{default:t(()=>[o(_(cs))]),_:1}),r(" 时间限制: "+i(c.value.timeLimit)+"ms ",1)]),s("span",Ms,[o(N,null,{default:t(()=>[o(_(ds))]),_:1}),r(" 内存限制: "+i(c.value.memoryLimit)+"MB ",1)])])]),s("div",Hs,[U.value?(n(),p(S,{key:0,type:"warning",icon:_(us),onClick:Q},{default:t(()=>[...e[2]||(e[2]=[r(" 编辑题目 ",-1)])]),_:1},8,["icon"])):m("",!0),D.value?(n(),p(S,{key:1,type:"primary",icon:_(rs),onClick:q},{default:t(()=>[...e[3]||(e[3]=[r(" 提交代码 ",-1)])]),_:1},8,["icon"])):m("",!0)])]),o(ss,{class:"page-card"},{default:t(()=>[o(Z,{modelValue:E.value,"onUpdate:modelValue":e[0]||(e[0]=l=>E.value=l),class:"problem-tabs"},{default:t(()=>[o(I,{label:"题目描述",name:"description"},{default:t(()=>[s("div",As,[e[4]||(e[4]=s("h3",{class:"section-title"},"题目描述",-1)),s("div",{class:"section-content",innerHTML:c.value.description},null,8,xs)]),s("div",Es,[e[5]||(e[5]=s("h3",{class:"section-title"},"输入说明",-1)),s("div",{class:"section-content",innerHTML:c.value.inputSpec},null,8,Ps)]),s("div",Us,[e[6]||(e[6]=s("h3",{class:"section-title"},"输出说明",-1)),s("div",{class:"section-content",innerHTML:c.value.outputSpec},null,8,zs)]),s("div",Bs,[e[7]||(e[7]=s("h3",{class:"section-title"},"输入样例",-1)),s("pre",Ds,[s("code",null,i(c.value.sampleInput),1)])]),s("div",qs,[e[8]||(e[8]=s("h3",{class:"section-title"},"输出样例",-1)),s("pre",Ns,[s("code",null,i(c.value.sampleOutput),1)])]),c.value.remark?(n(),u("div",Rs,[e[9]||(e[9]=s("h3",{class:"section-title"},"备注",-1)),s("div",{class:"section-content remark",innerHTML:c.value.remark},null,8,Vs)])):m("",!0)]),_:1}),o(I,{label:"提交记录",name:"submissions"},{default:t(()=>[s("div",$s,[w.value.length?(n(),u("div",js,[(n(!0),u(R,null,V(w.value,l=>(n(),u("div",{key:l.submissionId,class:"submission-item",onClick:ve=>O(l.submissionId)},[s("div",Gs,[o(k,{type:_(bs)(l.result),size:"small"},{default:t(()=>[r(i(_(hs)(l.result,"submission")),1)]),_:2},1032,["type"])]),s("div",Os,[s("span",Qs,i(l.nickname),1),s("span",Js,i(_(fs)(l.createdAt)),1)]),s("div",Ks,[s("span",null,i(l.timeUsed)+"ms",1),s("span",null,i(l.memoryUsed)+"MB",1)])],8,Fs))),128))])):(n(),p(z,{key:1,description:"暂无提交记录"}))])]),_:1}),o(I,{label:"题解",name:"solutions"},{default:t(()=>[s("div",Ws,[s("div",Xs,[e[11]||(e[11]=s("h3",null,"官方题解",-1)),U.value?(n(),p(S,{key:0,type:"primary",size:"small",onClick:J},{default:t(()=>[...e[10]||(e[10]=[r(" 发布题解 ",-1)])]),_:1})):m("",!0)]),g.value.length?(n(),u("div",Ys,[(n(!0),u(R,null,V(g.value,l=>(n(),u("div",{key:l.reportId,class:"solution-item"},[s("h4",Zs,i(l.title),1),s("div",{class:"solution-content",innerHTML:l.content},null,8,se),s("div",ee,[s("span",null,"发布时间: "+i(_(gs)(l.createdAt)),1)])]))),128))])):(n(),p(z,{key:1,description:"暂无题解"}))])]),_:1}),U.value?(n(),p(I,{key:0,label:"统计",name:"statistics"},{default:t(()=>[s("div",te,[o(W,{gutter:24},{default:t(()=>[o(M,{span:6},{default:t(()=>[s("div",oe,[s("div",le,i(C.value.totalSubmissions),1),e[12]||(e[12]=s("div",{class:"stat-label"},"总提交数",-1))])]),_:1}),o(M,{span:6},{default:t(()=>[s("div",ne,[s("div",ae,i(C.value.acceptedSubmissions),1),e[13]||(e[13]=s("div",{class:"stat-label"},"通过数",-1))])]),_:1}),o(M,{span:6},{default:t(()=>[s("div",ie,[s("div",ce,i(C.value.passRate)+"%",1),e[14]||(e[14]=s("div",{class:"stat-label"},"通过率",-1))])]),_:1}),o(M,{span:6},{default:t(()=>[s("div",de,[s("div",ue,i(C.value.uniqueUsers),1),e[15]||(e[15]=s("div",{class:"stat-label"},"尝试人数",-1))])]),_:1})]),_:1}),c.value.datasets&&c.value.datasets.length?(n(),u("div",re,[e[16]||(e[16]=s("h3",null,"测试数据",-1)),o(Y,{data:c.value.datasets,class:"detail-table"},{default:t(()=>[o(H,{prop:"version",label:"版本",width:"100",align:"center"}),o(H,{prop:"zipUrl",label:"文件地址","min-width":"300"},{default:t(({row:l})=>[o(X,{href:l.zipUrl,type:"primary",target:"_blank"},{default:t(()=>[r(i(l.zipUrl),1)]),_:2},1032,["href"])]),_:1}),o(H,{prop:"isActive",label:"状态",width:"100",align:"center"},{default:t(({row:l})=>[o(k,{type:l.isActive?"success":"info",size:"small"},{default:t(()=>[r(i(l.isActive?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),o(H,{prop:"addedAt",label:"添加时间",width:"180"})]),_:1},8,["data"])])):m("",!0)])]),_:1})):m("",!0)]),_:1},8,["modelValue"])]),_:1}),_(L)?(n(),u("div",_e,[o(S,{onClick:K},{default:t(()=>[...e[17]||(e[17]=[r("返回赛事",-1)])]),_:1}),D.value?(n(),p(S,{key:0,type:"primary",onClick:q},{default:t(()=>[...e[18]||(e[18]=[r("提交代码",-1)])]),_:1})):m("",!0)])):m("",!0)])):(n(),p(z,{key:1,description:"题目不存在或已被删除"}))]),_:1},8,["loading"])])}}}),ye=ms(me,[["__scopeId","data-v-2bd3ae63"]]);export{ye as default};
