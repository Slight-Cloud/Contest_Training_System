import{d as ee,u as te,r as T,s as V,k as z,p as le,c as oe,a as _,b as l,t as k,l as g,q as f,w as a,e as i,E as b,i as d,x as ae,y as se,z as ne,f as re,o as p,_ as ie}from"./index-jbbSaPHq.js";import{g as de,a as ce,u as pe,d as ue}from"./problem-FBqKQ2cr.js";import{f as me}from"./helpers-Cx3aqvDL.js";const _e={class:"problem-list-page page-shell"},ge={class:"page-header"},fe={class:"page-header__title"},be={class:"page-header__subtitle"},ye={class:"header-actions"},ve={class:"problem-name-cell"},ke={class:"problem-title"},he={class:"table-footer"},Ce=ee({__name:"list",setup(Se){const h=re(),y=te(),D=T([]),I=T(!1),n=V({keyword:"",isHidden:void 0,sortBy:"id_asc"}),r=V({page:1,pageSize:10,total:0}),P=z(()=>y.role==="ADMIN"),B=z(()=>y.role==="TEACHER"),E=z(()=>y.role==="STUDENT"),c=z(()=>P.value||B.value),$={background:"rgba(13, 17, 23, 0.65)",color:"#cdd9e5"},u=async()=>{I.value=!0;try{const e={page:r.page,pageSize:r.pageSize,keyword:n.keyword||void 0,sortBy:n.sortBy||"id_asc"};c.value&&(e.isHidden=n.isHidden),console.log("=== 题目列表请求调试 ==="),console.log("用户角色:",y.role),console.log("是否可管理:",c.value),console.log("请求参数:",e),console.log("用户Token:",y.token?`${y.token.substring(0,30)}...`:"null");const o=(await de(e)).data;o&&(D.value=o.problems||o.list||[],r.total=o.total||0,r.page=o.page||e.page||1,r.pageSize=o.pageSize||e.pageSize||10)}catch(e){console.error("=== 题目列表错误详情 ==="),console.error("错误类型:",e.name),console.error("错误消息:",e.message),console.error("响应状态:",e.response?.status),console.error("响应数据:",e.response?.data),console.error("响应头:",e.response?.headers),console.error("完整错误:",e),e.response?.status===403?b.error("权限不足：学生角色无法访问题目列表，请联系后端修改 Spring Security 配置"):b.error(`获取题目列表失败: ${e.message||"未知错误"}`)}finally{I.value=!1}},C=()=>{r.page=1,u()},A=()=>{n.keyword="",n.isHidden=void 0,n.sortBy="id_asc",r.page=1,u()},L=e=>{r.page=e,u()},N=e=>{r.pageSize=e,r.page=1,u()},U=e=>{h.push({name:"ProblemDetail",params:{id:e}})},M=()=>{h.push({name:"ProblemCreate"})},R=e=>{h.push({name:"ProblemEdit",params:{id:e}})},q=(e,t)=>{h.push({name:"ProblemSubmit",params:{id:e},query:{contestId:0,problemTitle:t,contestTitle:"练习模式"}})},K=async e=>{try{const o=(await ce(e.problemId)).data;if(!o){b.error("无法获取题目详情");return}await pe({problemId:o.problemId,title:o.title,description:o.description,inputSpec:o.inputSpec,outputSpec:o.outputSpec,sampleInput:o.sampleInput,sampleOutput:o.sampleOutput,remark:o.remark,timeLimit:o.timeLimit,memoryLimit:o.memoryLimit,isHidden:e.isHidden?0:1}),b.success(e.isHidden?"题目已显示":"题目已隐藏"),u()}catch{b.error("操作失败")}},O=async e=>{try{await ue(e),b.success("题目删除成功"),u()}catch{b.error("删除失败")}};le(u);const Z=e=>me(e);return(e,t)=>{const o=i("el-button"),j=i("el-input"),S=i("el-form-item"),m=i("el-option"),w=i("el-select"),F=i("el-form"),v=i("el-table-column"),G=i("el-tag"),H=i("el-popconfirm"),J=i("el-space"),Q=i("el-table"),W=i("el-pagination"),X=i("el-card"),Y=ne("loading");return p(),oe("div",_e,[_("div",ge,[_("div",null,[_("h2",fe,k(c.value?"题库管理":"题库列表"),1),_("p",be,k(c.value?"管理题目库，创建和编辑题目，为赛事准备题目资源":"浏览题目库，查看题目详情和练习"),1)]),_("div",ye,[c.value?(p(),g(o,{key:0,type:"primary",onClick:M},{default:a(()=>[...t[3]||(t[3]=[d("新建题目",-1)])]),_:1})):f("",!0),l(o,{type:"info",plain:"",onClick:u},{default:a(()=>[...t[4]||(t[4]=[d("刷新列表",-1)])]),_:1})])]),l(X,{class:"page-card"},{default:a(()=>[l(F,{inline:!0,model:n,"label-suffix":":",class:"filter-form"},{default:a(()=>[l(S,{label:"关键字"},{default:a(()=>[l(j,{modelValue:n.keyword,"onUpdate:modelValue":t[0]||(t[0]=s=>n.keyword=s),placeholder:"按题目名称搜索",clearable:"",onKeyup:se(C,["enter"]),style:{width:"200px"}},null,8,["modelValue"])]),_:1}),c.value?(p(),g(S,{key:0,label:"状态"},{default:a(()=>[l(w,{modelValue:n.isHidden,"onUpdate:modelValue":t[1]||(t[1]=s=>n.isHidden=s),placeholder:"全部",clearable:"",onChange:C,style:{width:"120px"}},{default:a(()=>[l(m,{label:"显示",value:0}),l(m,{label:"隐藏",value:1})]),_:1},8,["modelValue"])]),_:1})):f("",!0),l(S,{label:"排序"},{default:a(()=>[l(w,{modelValue:n.sortBy,"onUpdate:modelValue":t[2]||(t[2]=s=>n.sortBy=s),placeholder:"默认排序",clearable:"",onChange:C,style:{width:"140px"}},{default:a(()=>[l(m,{label:"最新创建",value:"created_desc"}),l(m,{label:"最早创建",value:"created_asc"}),l(m,{label:"ID升序",value:"id_asc"}),l(m,{label:"ID降序",value:"id_desc"}),l(m,{label:"标题A-Z",value:"title_asc"}),l(m,{label:"标题Z-A",value:"title_desc"})]),_:1},8,["modelValue"])]),_:1}),l(S,null,{default:a(()=>[l(o,{type:"primary",onClick:C},{default:a(()=>[...t[5]||(t[5]=[d("查询",-1)])]),_:1}),l(o,{onClick:A},{default:a(()=>[...t[6]||(t[6]=[d("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),ae((p(),g(Q,{data:D.value,border:"","header-cell-style":$,class:"problem-table"},{default:a(()=>[l(v,{prop:"problemId",label:"ID",width:"80",align:"center"}),l(v,{prop:"title",label:"题目名称","min-width":"200"},{default:a(({row:s})=>[_("div",ve,[_("span",ke,k(s.title||"-"),1),s.isHidden?(p(),g(G,{key:0,size:"small",type:"info",effect:"plain"},{default:a(()=>[...t[7]||(t[7]=[d("已隐藏",-1)])]),_:1})):f("",!0)])]),_:1}),l(v,{prop:"creatorId",label:"创建者ID",width:"120",align:"center"}),l(v,{prop:"createdAt",label:"创建时间",width:"200"},{default:a(({row:s})=>[d(k(Z(s.createdAt)),1)]),_:1}),l(v,{label:"操作","min-width":"220",fixed:"right"},{default:a(({row:s})=>[l(J,{wrap:""},{default:a(()=>[l(o,{size:"small",text:"",type:"primary",onClick:x=>U(s.problemId)},{default:a(()=>[...t[8]||(t[8]=[d("查看详情",-1)])]),_:1},8,["onClick"]),E.value?(p(),g(o,{key:0,size:"small",text:"",type:"success",onClick:x=>q(s.problemId,s.title)},{default:a(()=>[...t[9]||(t[9]=[d(" 开始练习 ",-1)])]),_:1},8,["onClick"])):f("",!0),c.value?(p(),g(o,{key:1,size:"small",text:"",type:"warning",onClick:x=>R(s.problemId)},{default:a(()=>[...t[10]||(t[10]=[d(" 编辑 ",-1)])]),_:1},8,["onClick"])):f("",!0),c.value?(p(),g(H,{key:2,title:`确定${s.isHidden?"显示":"隐藏"}该题目？`,"confirm-button-text":"确定","cancel-button-text":"取消",onConfirm:x=>K(s)},{reference:a(()=>[l(o,{size:"small",text:"",type:s.isHidden?"success":"info"},{default:a(()=>[d(k(s.isHidden?"显示":"隐藏"),1)]),_:2},1032,["type"])]),_:2},1032,["title","onConfirm"])):f("",!0),c.value?(p(),g(H,{key:3,title:"确定删除该题目？","confirm-button-text":"删除","cancel-button-text":"取消","confirm-button-type":"danger",onConfirm:x=>O(s.problemId)},{reference:a(()=>[l(o,{size:"small",text:"",type:"danger"},{default:a(()=>[...t[11]||(t[11]=[d("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])):f("",!0)]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Y,I.value]]),_("div",he,[l(W,{background:"",layout:"total, sizes, prev, pager, next, jumper","current-page":r.page,"page-size":r.pageSize,total:r.total,"page-sizes":[10,20,30,50],onSizeChange:N,onCurrentChange:L},null,8,["current-page","page-size","total"])])]),_:1})])}}}),De=ie(Ce,[["__scopeId","data-v-d92c627f"]]);export{De as default};
