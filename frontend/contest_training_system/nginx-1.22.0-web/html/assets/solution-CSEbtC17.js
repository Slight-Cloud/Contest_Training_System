import{d as ae,u as se,r as d,s as ne,k as y,g as ie,p as re,c as ue,a as r,b as l,t as p,l as f,q as k,w as t,e as i,E as x,i as n,x as de,z as ce,f as pe,o as m,_ as me}from"./index-jbbSaPHq.js";import{b as _e,p as B}from"./problem-FBqKQ2cr.js";const fe={class:"solution-page page-shell"},ve={class:"page-header"},be={class:"page-header__subtitle"},ge={class:"header-actions"},ye={class:"solution-title-cell"},ke={class:"solution-title"},we={class:"solution-content"},he={class:"solution-meta"},Ve=["innerHTML"],xe=ae({__name:"solution",setup(Ce){const A=ie(),E=pe(),D=se(),M=d([]),C=d(!1),v=d(!1),P=d(!1),I=d(!1),b=d(null),S=d(),s=ne({problemId:0,title:"",content:"",isPublished:1}),c=d({reportId:0,problemId:0,title:"",content:"",creatorId:0,creatorName:"",isPublished:0,createdAt:""}),w=y(()=>{const o=A.params.id;return Array.isArray(o)?Number(o[0]):Number(o)}),L=y(()=>A.query.title||"题目"),q=y(()=>D.role==="ADMIN"),F=y(()=>D.role==="TEACHER"),h=y(()=>q.value||F.value),H={title:[{required:!0,message:"请输入题解标题",trigger:"blur"},{min:2,max:100,message:"标题长度应在2-100字符之间",trigger:"blur"}],content:[{required:!0,message:"请输入题解内容",trigger:"blur"},{min:10,max:1e4,message:"内容长度应在10-10000字符之间",trigger:"blur"}]},V=async()=>{C.value=!0;try{const o=await _e(w.value);M.value=o.data||[]}catch(o){console.error(o),x.error("获取题解列表失败")}finally{C.value=!1}},R=o=>{o?(b.value=o.reportId,s.title=o.title,s.content=o.content,s.isPublished=o.isPublished):(b.value=null,s.title="",s.content="",s.isPublished=1),s.problemId=w.value,v.value=!0},j=async()=>{S.value&&await S.value.validate(async o=>{if(o){I.value=!0;try{await B(s),x.success(b.value?"题解修改成功":"题解发布成功"),v.value=!1,V()}catch(e){console.error(e)}finally{I.value=!1}}})},G=o=>{c.value={...o},P.value=!0},J=async o=>{try{await B({problemId:w.value,title:o.title,content:o.content,isPublished:1}),x.success("题解发布成功"),V()}catch(e){console.error(e)}},K=async o=>{try{x.success("题解删除成功"),V()}catch(e){console.error(e)}},O=o=>o?o.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>"):"暂无内容",Q=()=>{E.push({name:"ProblemDetail",params:{id:w.value}})};return re(V),(o,e)=>{const u=i("el-button"),_=i("el-table-column"),g=i("el-tag"),W=i("el-popconfirm"),X=i("el-space"),Y=i("el-table"),Z=i("el-card"),z=i("el-input"),N=i("el-form-item"),T=i("el-radio"),ee=i("el-radio-group"),te=i("el-form"),U=i("el-dialog"),le=i("el-divider"),oe=ce("loading");return m(),ue("div",fe,[r("div",ve,[r("div",null,[e[7]||(e[7]=r("h2",{class:"page-header__title"},"题解管理",-1)),r("p",be,p(L.value)+" - 管理题目的解题报告和题解",1)]),r("div",ge,[l(u,{text:"",type:"primary",onClick:Q},{default:t(()=>[...e[8]||(e[8]=[n("返回题目",-1)])]),_:1}),h.value?(m(),f(u,{key:0,type:"primary",onClick:e[0]||(e[0]=a=>R())},{default:t(()=>[...e[9]||(e[9]=[n("发布题解",-1)])]),_:1})):k("",!0)])]),l(Z,{class:"page-card"},{default:t(()=>[de((m(),f(Y,{data:M.value,border:"",class:"detail-table"},{default:t(()=>[l(_,{prop:"reportId",label:"ID",width:"80",align:"center"}),l(_,{prop:"title",label:"题解标题","min-width":"250"},{default:t(({row:a})=>[r("div",ye,[r("span",ke,p(a.title),1),a.isPublished?k("",!0):(m(),f(g,{key:0,size:"small",type:"warning",effect:"plain"},{default:t(()=>[...e[10]||(e[10]=[n("未发布",-1)])]),_:1}))])]),_:1}),l(_,{prop:"creatorName",label:"作者",width:"120"}),l(_,{prop:"createdAt",label:"创建时间",width:"180"}),l(_,{label:"状态",width:"100",align:"center"},{default:t(({row:a})=>[l(g,{type:a.isPublished?"success":"warning"},{default:t(()=>[n(p(a.isPublished?"已发布":"草稿"),1)]),_:2},1032,["type"])]),_:1}),l(_,{label:"操作","min-width":"200",fixed:"right"},{default:t(({row:a})=>[l(X,{wrap:""},{default:t(()=>[l(u,{size:"small",text:"",type:"primary",onClick:$=>G(a)},{default:t(()=>[...e[11]||(e[11]=[n("查看",-1)])]),_:1},8,["onClick"]),h.value?(m(),f(u,{key:0,size:"small",text:"",type:"warning",onClick:$=>R(a)},{default:t(()=>[...e[12]||(e[12]=[n(" 编辑 ",-1)])]),_:1},8,["onClick"])):k("",!0),h.value&&!a.isPublished?(m(),f(u,{key:1,size:"small",text:"",type:"success",onClick:$=>J(a)},{default:t(()=>[...e[13]||(e[13]=[n(" 发布 ",-1)])]),_:1},8,["onClick"])):k("",!0),h.value?(m(),f(W,{key:2,title:"确定删除该题解？","confirm-button-text":"删除","cancel-button-text":"取消","confirm-button-type":"danger",onConfirm:$=>K(a.reportId)},{reference:t(()=>[l(u,{size:"small",text:"",type:"danger"},{default:t(()=>[...e[14]||(e[14]=[n("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])):k("",!0)]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[oe,C.value]])]),_:1}),l(U,{modelValue:v.value,"onUpdate:modelValue":e[5]||(e[5]=a=>v.value=a),title:b.value?"编辑题解":"发布题解",width:"80%","close-on-click-modal":!1},{footer:t(()=>[l(u,{onClick:e[4]||(e[4]=a=>v.value=!1)},{default:t(()=>[...e[17]||(e[17]=[n("取消",-1)])]),_:1}),l(u,{type:"primary",loading:I.value,onClick:j},{default:t(()=>[n(p(b.value?"保存修改":"发布题解"),1)]),_:1},8,["loading"])]),default:t(()=>[l(te,{ref_key:"solutionFormRef",ref:S,model:s,rules:H,"label-width":"100px"},{default:t(()=>[l(N,{label:"题解标题",prop:"title"},{default:t(()=>[l(z,{modelValue:s.title,"onUpdate:modelValue":e[1]||(e[1]=a=>s.title=a),placeholder:"请输入题解标题",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(N,{label:"题解内容",prop:"content"},{default:t(()=>[l(z,{modelValue:s.content,"onUpdate:modelValue":e[2]||(e[2]=a=>s.content=a),type:"textarea",rows:15,placeholder:"请输入题解内容，支持Markdown格式",maxlength:"10000","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(N,{label:"发布状态"},{default:t(()=>[l(ee,{modelValue:s.isPublished,"onUpdate:modelValue":e[3]||(e[3]=a=>s.isPublished=a)},{default:t(()=>[l(T,{label:0},{default:t(()=>[...e[15]||(e[15]=[n("保存为草稿",-1)])]),_:1}),l(T,{label:1},{default:t(()=>[...e[16]||(e[16]=[n("立即发布",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(U,{modelValue:P.value,"onUpdate:modelValue":e[6]||(e[6]=a=>P.value=a),title:c.value.title,width:"80%","close-on-click-modal":!1},{default:t(()=>[r("div",we,[r("div",he,[l(g,{type:"info"},{default:t(()=>[n("作者："+p(c.value.creatorName),1)]),_:1}),l(g,{type:"success"},{default:t(()=>[n(p(c.value.createdAt),1)]),_:1}),l(g,{type:c.value.isPublished?"success":"warning"},{default:t(()=>[n(p(c.value.isPublished?"已发布":"草稿"),1)]),_:1},8,["type"])]),l(le),r("div",{class:"solution-body",innerHTML:O(c.value.content)},null,8,Ve)])]),_:1},8,["modelValue","title"])])}}}),Se=me(xe,[["__scopeId","data-v-ea9ae6cb"]]);export{Se as default};
